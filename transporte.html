<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Transporte</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #000, #0a0a1a, #001122);
      color: #fff;
      padding: 15px;
      min-height: 100vh;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding: 20px;
      background: rgba(17, 24, 39, 0.95);
      border-radius: 15px;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 32px rgba(255, 140, 0, 0.3);
      border: 1px solid rgba(255, 140, 0, 0.2);
      animation: slideInDown 0.8s ease;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff8c00, #ff6b00);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      animation: pulse 2s infinite;
    }
    
    h2 {
      color: #ff8c00;
      text-shadow: 0 0 15px rgba(255, 140, 0, 0.6);
      margin: 0;
      font-size: 24px;
    }
    
    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
    }
    
    .connected {
      background: #28a745;
      color: white;
    }
    
    .disconnected {
      background: #ff4444;
      color: white;
    }
    
    .section {
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(15px);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(255, 140, 0, 0.3);
      border: 1px solid rgba(255, 140, 0, 0.2);
      margin-bottom: 30px;
      animation: slideInUp 0.8s ease;
    }
    
    .search-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .search-method {
      background: rgba(10, 10, 26, 0.8);
      border: 2px solid rgba(255, 140, 0, 0.3);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      position: relative;
      overflow: hidden;
    }
    
    .search-method::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 140, 0, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .search-method:hover::before {
      left: 100%;
    }
    
    .search-method:hover {
      border-color: #ff8c00;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 140, 0, 0.3);
    }
    
    .search-method.active {
      background: rgba(255, 140, 0, 0.15);
      border-color: #ff8c00;
      box-shadow: 0 0 15px rgba(255, 140, 0, 0.4);
    }
    
    .search-method-icon {
      font-size: 20px;
      margin-bottom: 8px;
      display: block;
    }
    
    label {
      display: block;
      margin-bottom: 10px;
      font-size: 14px;
      color: #ccc;
      font-weight: 500;
    }
    
    input {
      width: 100%;
      padding: 15px;
      border: 2px solid rgba(255, 140, 0, 0.3);
      border-radius: 12px;
      background: rgba(10, 10, 26, 0.9);
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    
    input:focus {
      outline: none;
      border-color: #ff8c00;
      box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.15);
      transform: translateY(-2px);
    }
    
    button {
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #ff8c00, #ff6b00);
      color: #fff;
      width: 100%;
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(255, 140, 0, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #ff4444, #cc0000);
      color: #fff;
    }
    
    .btn-danger:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(255, 68, 68, 0.4);
    }
    
    .result-section {
      display: none;
      animation: bounceIn 0.8s ease;
    }
    
    .client-card {
      background: rgba(10, 10, 26, 0.8);
      padding: 25px;
      border-radius: 15px;
      border-left: 5px solid #ff8c00;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .client-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255, 140, 0, 0.05), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    .client-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(255, 140, 0, 0.25);
    }
    
    .client-card:hover::before {
      opacity: 1;
    }
    
    .client-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
      position: relative;
      z-index: 1;
    }
    
    .client-field {
      display: flex;
      flex-direction: column;
    }
    
    .client-field strong {
      color: #ff8c00;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .client-field span {
      font-size: 16px;
      word-break: break-word;
    }
    
    .client-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      position: relative;
      z-index: 1;
    }
    
    .action-btn {
      background: linear-gradient(45deg, #ff8c00, #ff6b00);
      color: #fff;
      padding: 12px 16px;
      border-radius: 10px;
      text-decoration: none;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 140, 0, 0.4);
      color: #fff;
      text-decoration: none;
    }
    
    .action-btn.whatsapp {
      background: linear-gradient(45deg, #25d366, #128c7e);
    }
    
    .action-btn.whatsapp:hover {
      box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
    }
    
    .action-btn.maps {
      background: linear-gradient(45deg, #4285f4, #34a853);
    }
    
    .action-btn.maps:hover {
      box-shadow: 0 8px 20px rgba(66, 133, 244, 0.4);
    }
    
    .action-btn.waze {
      background: linear-gradient(45deg, #00d8ff, #0099cc);
    }
    
    .action-btn.waze:hover {
      box-shadow: 0 8px 20px rgba(0, 216, 255, 0.4);
    }
    
    .client-selector {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 140, 0, 0.2);
      border-radius: 12px;
      padding: 15px;
    }
    
    .client-checkbox {
      display: flex;
      align-items: center;
      padding: 12px;
      background: rgba(10, 10, 26, 0.6);
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    
    .client-checkbox:hover {
      background: rgba(255, 140, 0, 0.1);
      border-color: rgba(255, 140, 0, 0.3);
      transform: translateX(5px);
    }
    
    .client-checkbox input {
      width: auto;
      margin-right: 12px;
      margin-bottom: 0;
      transform: scale(1.2);
    }
    
    .client-checkbox-info {
      flex: 1;
    }
    
    .client-checkbox-title {
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .client-checkbox-details {
      font-size: 12px;
      color: #ccc;
    }
    
    .selected-count {
      background: linear-gradient(45deg, #ff8c00, #ff6b00);
      color: #fff;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: bold;
      margin-bottom: 20px;
      display: inline-block;
      animation: pulse 1s infinite;
    }
    
    .error-message {
      background: linear-gradient(45deg, #ff4444, #cc0000);
      color: #fff;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin: 15px 0;
      display: none;
      animation: shake 0.6s ease;
    }
    
    .success-message {
      background: linear-gradient(45deg, #28a745, #20c997);
      color: #fff;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin: 15px 0;
      display: none;
      animation: bounceIn 0.6s ease;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6c757d;
      font-style: italic;
    }
    
    /* Animaciones */
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.7);
      }
      70% { 
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(255, 140, 0, 0);
      }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
      20%, 40%, 60%, 80% { transform: translateX(8px); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .search-methods {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .client-info {
        grid-template-columns: 1fr;
      }
      
      .client-actions {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="connection-status" id="connectionStatus">üîÑ Conectando...</div>
  
  <div class="header">
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">T</div>
      <div>
        <div>Bienvenido, <strong id="userName">Usuario</strong></div>
        <div style="font-size: 12px; color: #6c757d;">Rol: Transporte</div>
      </div>
    </div>
    <h2>üöö Panel de Transporte</h2>
    <button class="btn-danger" onclick="cerrarSesion()">
      üîì Cerrar Sesi√≥n
    </button>
  </div>

  <!-- B√∫squeda Individual -->
  <div class="section">
    <h3>üîç Buscar Cliente Individual</h3>
    
    <div class="search-methods">
      <div class="search-method active" onclick="cambiarMetodo('codigo')">
        <span class="search-method-icon">üè∑Ô∏è</span>
        <div>C√≥digo</div>
      </div>
      <div class="search-method" onclick="cambiarMetodo('nombre')">
        <span class="search-method-icon">üë§</span>
        <div>Nombre</div>
      </div>
      <div class="search-method" onclick="cambiarMetodo('celular')">
        <span class="search-method-icon">üì±</span>
        <div>Celular</div>
      </div>
      <div class="search-method" onclick="cambiarMetodo('ubicacion')">
        <span class="search-method-icon">üìç</span>
        <div>Ubicaci√≥n</div>
      </div>
    </div>

    <label id="searchLabel">Ingrese C√≥digo de Cliente:</label>
    <input type="text" id="campoBusqueda" placeholder="Ej: C001">
    <button class="btn-primary" onclick="buscarCliente()">üîç Buscar</button>
    
    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>
  </div>

  <!-- Resultado Individual -->
  <div class="section result-section" id="resultSection">
    <h3>‚úÖ Cliente Encontrado</h3>
    <div id="clienteEncontrado"></div>
  </div>

  <!-- B√∫squeda M√∫ltiple -->
  <div class="section">
    <h3>üìã Ruta M√∫ltiple Optimizada</h3>
    <p style="color: #ccc; font-size: 14px; margin-bottom: 20px;">
      üó∫Ô∏è Selecciona varios clientes para crear una <strong>ruta optimizada</strong>. Google Maps ordenar√° autom√°ticamente las paradas de manera eficiente comenzando por el cliente m√°s cercano.
    </p>
    
    <div class="selected-count" id="selectedCount">0 clientes seleccionados</div>
    
    <div class="client-selector" id="clientSelector">
      <div class="empty-state">Cargando clientes...</div>
    </div>
    
    <button class="btn-primary" onclick="crearRutaOptimizada()" id="btnRuta" disabled>
      üó∫Ô∏è Crear Ruta Optimizada
    </button>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    // ‚úÖ CONFIGURACI√ìN SUPABASE
    const SUPABASE_URL = 'https://tghrujeeotgfseqonskm.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnaHJ1amVlb3RnZnNlcW9uc2ttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNDk4OTgsImV4cCI6MjA3MjgyNTg5OH0.mA1MyI43Lx7OTtmShNc9uAdZG2C9IYBBnpsbej7GkR0';
    
    let supabase;
    let clientes = [];
    let usuarioActual = null;
    let metodoBusqueda = 'codigo';
    let clientesSeleccionados = [];
    let conectado = false;

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
      verificarSesion();
      inicializarSupabase();
      inicializarEventos();
    });

    function verificarSesion() {
      const sesion = sessionStorage.getItem("sesion");
      if (!sesion) {
        window.location.href = "index.html";
        return;
      }
      
      usuarioActual = JSON.parse(sesion);
      if (usuarioActual.rol !== 'transporte') {
        window.location.href = "index.html";
        return;
      }
      
      document.getElementById("userName").textContent = usuarioActual.usuario;
      document.getElementById("userAvatar").textContent = usuarioActual.usuario.charAt(0).toUpperCase();
      conectado = usuarioActual.conectado || false;
    }

    function inicializarSupabase() {
      try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        verificarConexion();
      } catch (error) {
        console.error('Error inicializando Supabase:', error);
        mostrarEstadoConexion(false, 'Error de Conexi√≥n');
        modoOffline();
      }
    }

    async function verificarConexion() {
      try {
        const { data, error } = await supabase.from('clientes').select('count', { count: 'exact', head: true });
        if (error) throw error;
        conectado = true;
        mostrarEstadoConexion(true, 'Conectado a la Nube');
        cargarClientes();
      } catch (error) {
        console.error('Error de conexi√≥n:', error);
        conectado = false;
        mostrarEstadoConexion(false, 'Modo Offline');
        modoOffline();
      }
    }

    function mostrarEstadoConexion(estado, texto) {
      const statusEl = document.getElementById('connectionStatus');
      statusEl.textContent = `${estado ? 'üü¢' : 'üî¥'} ${texto}`;
      statusEl.className = `connection-status ${estado ? 'connected' : 'disconnected'}`;
    }

    function modoOffline() {
      clientes = JSON.parse(localStorage.getItem('clientes')) || [];
      mostrarSelectorClientes();
    }

    function inicializarEventos() {
      document.getElementById('campoBusqueda').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          buscarCliente();
        }
      });
    }

    async function cargarClientes() {
      if (conectado && supabase) {
        try {
          const { data, error } = await supabase
            .from('clientes')
            .select('*')
            .order('created_at', { ascending: false });
            
          if (error) throw error;
          
          clientes = data || [];
          
          // Sincronizar con localStorage
          localStorage.setItem('clientes', JSON.stringify(clientes));
          
          mostrarSelectorClientes();
          
        } catch (error) {
          console.error('Error cargando clientes:', error);
          modoOffline();
        }
      } else {
        modoOffline();
      }
    }

    function cambiarMetodo(metodo) {
      metodoBusqueda = metodo;
      
      // Actualizar UI
      document.querySelectorAll('.search-method').forEach(el => el.classList.remove('active'));
      event.target.closest('.search-method').classList.add('active');
      
      const labels = {
        codigo: { label: 'Ingrese C√≥digo de Cliente:', placeholder: 'Ej: C001' },
        nombre: { label: 'Ingrese Nombre del Cliente:', placeholder: 'Ej: Juan P√©rez' },
        celular: { label: 'Ingrese Celular del Cliente:', placeholder: 'Ej: +51 999 999 999' },
        ubicacion: { label: 'Ingrese Ubicaci√≥n del Cliente:', placeholder: 'Ej: Av. Principal 123' }
      };
      
      document.getElementById('searchLabel').textContent = labels[metodo].label;
      document.getElementById('campoBusqueda').placeholder = labels[metodo].placeholder;
      document.getElementById('campoBusqueda').value = '';
    }

    function buscarCliente() {
      const termino = document.getElementById('campoBusqueda').value.trim().toLowerCase();
      
      if (!termino) {
        mostrarError('Ingrese un t√©rmino de b√∫squeda');
        return;
      }

      let cliente;
      
      switch(metodoBusqueda) {
        case 'codigo':
          cliente = clientes.find(c => c.codigo.toLowerCase() === termino);
          break;
        case 'nombre':
          cliente = clientes.find(c => c.nombre.toLowerCase().includes(termino));
          break;
        case 'celular':
          cliente = clientes.find(c => c.celular.includes(termino));
          break;
        case 'ubicacion':
          cliente = clientes.find(c => c.ubicacion.toLowerCase().includes(termino));
          break;
      }

      if (cliente) {
        mostrarResultado(cliente);
        mostrarExito(`Cliente ${cliente.codigo} encontrado`);
      } else {
        mostrarError('Cliente no encontrado');
        document.getElementById('resultSection').style.display = 'none';
      }
    }

    function mostrarResultado(cliente) {
      const container = document.getElementById('clienteEncontrado');
      
      container.innerHTML = `
        <div class="client-card">
          <div class="client-info">
            <div class="client-field">
              <strong>C√≥digo</strong>
              <span>${cliente.codigo}</span>
            </div>
            <div class="client-field">
              <strong>Nombre</strong>
              <span>${cliente.nombre}</span>
            </div>
            <div class="client-field">
              <strong>Celular</strong>
              <span>${cliente.celular}</span>
            </div>
            ${cliente.email ? `
            <div class="client-field">
              <strong>Email</strong>
              <span>${cliente.email}</span>
            </div>
            ` : ''}
            <div class="client-field">
              <strong>Ubicaci√≥n</strong>
              <span>${cliente.ubicacion}</span>
            </div>
            ${cliente.referencia ? `
            <div class="client-field">
              <strong>Referencia</strong>
              <span>${cliente.referencia}</span>
            </div>
            ` : ''}
          </div>
          <div class="client-actions">
            <a href="tel:${cliente.celular}" class="action-btn">
              üìû Llamar
            </a>
            <a href="https://wa.me/${cliente.celular.replace(/\D/g, '')}" target="_blank" class="action-btn whatsapp">
              üí¨ WhatsApp
            </a>
            <a href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(cliente.ubicacion)}" target="_blank" class="action-btn maps">
              üìç Google Maps
            </a>
            <a href="https://waze.com/ul?q=${encodeURIComponent(cliente.ubicacion)}" target="_blank" class="action-btn waze">
              üöó Waze
            </a>
          </div>
        </div>
      `;
      
      document.getElementById('resultSection').style.display = 'block';
      document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
    }

    function mostrarSelectorClientes() {
      const container = document.getElementById('clientSelector');
      
      if (clientes.length === 0) {
        container.innerHTML = '<div class="empty-state">No hay clientes registrados</div>';
        return;
      }
      
      container.innerHTML = clientes.map((cliente, index) => `
        <div class="client-checkbox">
          <input type="checkbox" id="cliente_${index}" onchange="actualizarSeleccion(${index})">
          <div class="client-checkbox-info">
            <div class="client-checkbox-title">${cliente.codigo} - ${cliente.nombre}</div>
            <div class="client-checkbox-details">üìç ${cliente.ubicacion}</div>
            <div class="client-checkbox-details">üì± ${cliente.celular}</div>
          </div>
        </div>
      `).join('');
    }

    function actualizarSeleccion(index) {
      const checkbox = document.getElementById(`cliente_${index}`);
      
      if (checkbox.checked) {
        if (!clientesSeleccionados.includes(index)) {
          clientesSeleccionados.push(index);
        }
      } else {
        clientesSeleccionados = clientesSeleccionados.filter(i => i !== index);
      }
      
      document.getElementById('selectedCount').textContent = `${clientesSeleccionados.length} clientes seleccionados`;
      document.getElementById('btnRuta').disabled = clientesSeleccionados.length < 2;
    }

    async function crearRutaOptimizada() {
      if (clientesSeleccionados.length < 2) {
        mostrarError('Seleccione al menos 2 clientes para crear una ruta');
        return;
      }

      const clientesRuta = clientesSeleccionados.map(index => clientes[index]);
      
      // Crear URL de Google Maps con waypoints optimizados
      let url = "https://www.google.com/maps/dir/";
      
      // Agregar punto de partida (ubicaci√≥n actual)
      url += "Mi+ubicaci√≥n/";
      
      // Agregar destinos
      clientesRuta.forEach((cliente, index) => {
        url += encodeURIComponent(cliente.ubicacion);
        if (index < clientesRuta.length - 1) {
          url += "/";
        }
      });
      
      // ‚≠ê RUTA OPTIMIZADA - Google Maps ordenar√° autom√°ticamente
      url += "?optimize:true";
      
      // Mostrar confirmaci√≥n con detalles de la ruta
      const confirmMessage = `üó∫Ô∏è RUTA OPTIMIZADA\n\n` +
        `üìä Resumen de la ruta:\n` +
        `‚Ä¢ ${clientesRuta.length} paradas seleccionadas\n` +
        `‚Ä¢ Google Maps optimizar√° el orden autom√°ticamente\n` +
        `‚Ä¢ Comenzar√° desde tu ubicaci√≥n actual\n\n` +
        `üìã Clientes incluidos:\n` +
        clientesRuta.map((c, i) => `${i + 1}. ${c.codigo} - ${c.nombre}\n   üìç ${c.ubicacion}`).join('\n\n') +
        `\n\n¬øAbrir ruta optimizada en Google Maps?`;
      
      if (confirm(confirmMessage)) {
        // Abrir Google Maps con ruta optimizada
        window.open(url, '_blank');
        
        // Limpiar selecci√≥n despu√©s de crear la ruta
        clientesSeleccionados = [];
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.getElementById('selectedCount').textContent = '0 clientes seleccionados';
        document.getElementById('btnRuta').disabled = true;
        
        mostrarExito(`Ruta optimizada con ${clientesRuta.length} paradas abierta en Google Maps`);
      }
    }

    function mostrarExito(mensaje) {
      const successMsg = document.getElementById('successMessage');
      successMsg.textContent = `‚úÖ ${mensaje}`;
      successMsg.style.display = 'block';
      setTimeout(() => {
        successMsg.style.display = 'none';
      }, 4000);
    }

    function mostrarError(mensaje) {
      const errorMsg = document.getElementById('errorMessage');
      errorMsg.textContent = `‚ùå ${mensaje}`;
      errorMsg.style.display = 'block';
      setTimeout(() => {
        errorMsg.style.display = 'none';
      }, 4000);
    }

    function cerrarSesion() {
      if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
        sessionStorage.removeItem("sesion");
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.5s ease';
        setTimeout(() => window.location.href = "index.html", 500);
      }
    }
  </script>
</body>
</html>
